.costered-blocks--sidebar {
    /* Override default notice width */
    .components-notice__content {
        margin-right: 0 !important;
    }

    .costered-blocks--sidebar-header {
        /* .costered-blocks--header-selected-block {  } */

        .costered-blocks--sidebar-tabs {
            .costered-blocks--tab-icon-object {
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
        }

    }
    
    .costered-blocks--block-difference-warning {
        margin-top: 1rem;
    }
    
    .costered-blocks--sidebar-body {
        
        .costered-blocks--tab--display-controls {
            .costered-blocks--display-controls--inner {
                margin-bottom: 1rem;
            }
        }
    }
}

/* Common UI elements */

.costered-blocks--icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    width: var(--cb-icon-size, 24px);
    height: var(--cb-icon-size, 24px);
    color: var(--cb-icon-foreground, inherit);
    background-color: var(--cb-icon-background, transparent);
    
    .dashicons {
        font-size: var(--cb-icon-size, 24px);
        width: 1em;
        height: 1em;
        line-height: 1;
    }

    svg {
        width: 100%;
        height: 100%;
        display: inline-block;
    }
}

.costered-blocks--unsaved-dot {
    background-color: var(--wp-admin-theme-color, #3858e9);
    border-radius: 50%; 
    display: inline-block;
    height: 0.5rem;
    margin-left: 0.25rem;
    width: 0.5rem;
}

.costered-blocks--unsaved-icon {
    color: var(--wp-admin-theme-color, #3858e9);
    display: inline-block;
    fill: var(--wp-admin-theme-color, #3858e9);
    height: 1rem;
    margin-left: 0.25rem;
    vertical-align: middle;
    width: 1rem;
}

fieldset.costered-blocks--fieldset {
    border:1px solid #DCDCDE;
    border-radius:4px;
    padding:0.5rem;
    position:relative;

    .costered-blocks--unsaved-icon,
    .costered-blocks--unsaved-dot {
        position: absolute;
        top: 0rem;
        right: 0.5rem;
    }    
}

/* Custom Select Control */

.costered-blocks--custom-select {
    position: relative;
    flex: 1;
    min-width:180px;

    .costered-blocks--custom-select--label {
        display: block;
        margin-bottom: 0.25rem;
        font-size: 0.875em;
        font-weight: 500;
        text-transform: uppercase;
    }

    .costered-blocks--custom-select--button {
        display: flex;
        align-items: center;
        width: 100%;
        padding: 0.5rem 0.75rem;
        font-size: 1em;
        border: 1px solid #949494;
        border-radius: 0.25rem;
        background: #fff;
        cursor: pointer;
        gap: 0.5rem;

        .costered-blocks--custom-select--selected {
            display:flex;
            align-items: center;
            gap: 0.5rem;
            flex-grow: 1;
            color: #333;

            .costered-blocks--custom-select--selected-inner {
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                gap: 0.5rem;

                &.is-rtl {
                    flex-direction: row-reverse;
                }   
            }

            .costered-blocks--custom-select--arrow {
                margin-left: auto;
                color: #888;
            }
        }
    }

    .costered-blocks--custom-select--list {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 10;
        width: 100%;
        margin: 0;
        padding: 0;
        background: #fff;
        border: 1px solid #dcdcde;
        border-radius: 0.25rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        list-style: none;
        max-height: 240px;
        overflow-y: auto;

        .costered-blocks--custom-select--list-item {
            display: block;
            padding: 0.5rem 0.75rem;
            
            .costered-blocks--custom-select--list-item--inner {
                display: flex;
                flex-direction: row;

                &.is-rtl {
                    flex-direction: row-reverse;
                }

                .costered-blocks--custom-select--list-item--label {
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                    gap: 0.5rem;
                }

                /* .costered-blocks--custom-select--list-item--checkmark {} */

            }
        }
    }
}

/* Icon Button */
.costered-blocks--icon-button {

    &.costered-blocks--clear-button {
        margin-left:0.25rem;
        opacity: 0.8;

        &:hover {
            opacity: 1;
        }
    }

}

/* CustomNotice */
.costered-blocks--custom-notice {
    
    &.costered-blocks--custom-notice--type-info {
        background-color: var(--wp-components-color-notice-info-background, #e7f4fa);
    }

    &.costered-blocks--custom-notice--type-warning {
        background-color: var(--wp-components-color-notice-warning-background, #fff4e5);
    }

    &.costered-blocks--custom-notice--type-error {
        background-color: var(--wp-components-color-notice-error-background, #fef0f0);
    }

    details {
        summary {
            cursor: pointer;
            font-weight: 500;
        }

        .costered-blocks--custom-notice--body {
            margin-top: 1rem;
        }
    }
}

/* CustomToggleGroup */
.costered-blocks--custom-toggle-group {
    padding: 2px;
    border-radius: 3px !important;
    box-shadow: 0 0 0 1px #8c8f94 inset;

    &.is-empty::before {
        background-color: transparent !important;
    }
}

/* CustomToggleGrid */
.costered-blocks--custom-toggle-grid {
    --selected-top: 0;
    --selected-left: 0;
    --selected-bottom: 0;
    --selected-right: 0;
    --selected-width: 0;
    --selected-height: 0;

    .costered-blocks--custom-toggle-grid--control {
        position: relative;
        margin: 0;
        padding: 0;

        .costered-blocks--custom-toggle-grid--grid {
            position: relative;
            display: grid;
            gap: 0.5rem;

            grid-template-columns: var(--cb-grid-template-columns, repeat(3, minmax(0, 1fr)));

            .costered-blocks--custom-toggle-grid--tile {
                width: 100%;
                outline: 0 none;
                box-sizing: border-box;
                justify-content: center;
                padding: 0;
                aspect-ratio: 1 / 1;
                border-radius: 4px;
                border: 1px solid transparent;

                & > div {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    gap: 0.25rem;
                }

                &:focus,
                &:focus-within,
                &:focus-visible {
                    outline: 0 none;
                    box-shadow: none;
                }
            }
        }

        &::before {
            content: "";
            display: block;
            position: absolute;
            top: calc(var(--selected-top, 0) * 1px);
            border-radius: 4px;
            box-shadow: none;
            pointer-events: none;
            transition:
                left 120ms ease,
                top 120ms ease,
                width 120ms ease,
                height 120ms ease;
        }
    }
}

/* DimensionInputGroup */
.costered-blocks--dimension-input-group {
    margin-bottom: 1rem;
}

/* DirectionalInputGroup */
.costered-blocks--directional-input-group {
    margin-bottom: 1rem;
    position: relative;

    .costered-blocks--directional-input-group--rectangle {
        position: absolute;
        top: 43px;
        left: 45px;
        right: 45px;
        bottom: 58px;
        border: 1px solid #ccc;
        pointer-events: none;
        z-index: 1;
    }

    .costered-blocks--directional-input-group--toggle {
        grid-column: 1 / span 10;
        grid-row: 4;
    }
}

/* GridAxisAside */
.costered-blocks--grid-axis-aside {
    display: flex;
    flex: 0 0 32px;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    position: relative;
    width: 32px;

    .costered-blocks--grid-axis-aside--pip {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #000; /* uses admin theme color by default */
        opacity: 0.2; /* no value */
        transition:
            opacity 0.15s ease,
            box-shadow 0.15s ease;
        position: absolute;
        top: 2px;
        right: 2px;

        .costered-blocks--grid-axis-aside.is-owned-here & {
            opacity: 1; /* value set here */
            background: var(--wp-admin-theme-color, #3858e9);
        }

        .costered-blocks--grid-axis-aside.is-elsewhere & {
            opacity: 0.6; /* value set elsewhere */
            box-shadow: 0 0 0 2px currentColor inset;
        }
    }
}

/* TokenEditor */
.costered-blocks--token-editor {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;

    .costered-blocks--token-editor--controls {
        .costered-blocks--token-editor--add {
            display: flex;
            /* flex-direction:column; */
            flex-wrap: nowrap;
            gap: 0.25rem;
            align-items: center;

            .costered-blocks--token-editor--add-input {
                flex: 2;
                margin-bottom: 0 !important; /* override wp */
            }

            .costered-blocks--token-editor--add-options {
                align-items: center;
                display: flex;
                flex: 1;
                gap: 0.25rem;
            }
        }
    }


    .costered-blocks--token-editor--list {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.25rem;

        .costered-blocks--token--type-label-token {
            background-color:#f0f6fc;
        }

        .costered-blocks--token--type-value-token {
            background-color:#fcf0f1;
        }
    }
}

/* TokenGrid */
.costered-blocks--token-grid-component {

    .costered-blocks--token-grid--area {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        overflow-x: scroll;
        overscroll-behavior: contain;
        scrollbar-gutter: stable both-edges;
        border-top: 1px solid var(--wp--custom--token-border, #dcdcde);
        border-left: 1px solid var(--wp--custom--token-border, #dcdcde);
        background-color: var(--wp-components-color-accent-1, #f6f7f7);

        /* wp style reset */
        .components-modal__content & {
            width: auto;
            max-width: unset;
            overflow-x: unset;
        }

        .costered-blocks--token-grid--row {
            flex: 1;
            flex-wrap: nowrap;
            display:inline-grid;
            grid-auto-flow:column;
            grid-template-columns: 80px;
            grid-auto-columns: minmax(100px, max-content);
            grid-auto-rows: minmax(48px, auto);
            inline-size: max-content;
            min-inline-size: max-content;

            .costered-blocks--token-grid--cell {
                border-bottom: 1px solid var(--wp--custom--token-border, #dcdcde);
                border-right: 1px solid var(--wp--custom--token-border, #dcdcde);
                padding: 4px;
            }

            .costered-blocks--token-grid--controls {
                display: flex;
                justify-content: center;
            }

            .costered-blocks--token {
                width: 100%;
            }
        }
    }
}

/* Token */
.costered-blocks--token {
    border: 1px solid var(--wp--custom--token-border, #dcdcde);
    border-radius: 6px;
    padding: 0.25rem;
    background: #fff;
    width: fit-content;

    .costered-blocks--token--chip {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.25rem;

        button.costered-blocks--token--chip-button {
            all: unset;
            cursor: pointer;
            padding: 0 0 0 0.25rem;
            border-radius: 4px;
            height: 24px;
            line-height: 24px;

            &:focus-visible {
                outline: 2px solid var(--wp-admin-theme-color, #3858e9);
                outline-offset: 2px;
            }
        }

        span.costered-blocks--token--chip-text {
            display: block;
            max-width: 80px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 24px;

            .is-expanded & {
                max-width: unset;
            }
        }

        button.costered-blocks--token--remove.components-button {
            padding: 0;
            width: 24px;
            height: 24px;
            border-radius: 6px;
            min-width: unset;
        }
    }
}

.costered-blocks--token--popover {

    &:not(.is-active) .components-popover__content {
        /* popovers render outside of the normal flow, and when collapsed,
        the box-shadow shows as a little grey dot over the top of everything */
        box-shadow: none;
    }

    .costered-blocks--token--panel {
        display:flex;
        flex-direction: column;
        gap:0.5rem;
        padding:0.25rem;

        .costered-blocks--token--actions {
            display: flex;
            gap: 0.25rem;
            align-items: center;
        }
    }

    /* wp style reset */
    .costered-blocks--token--popover .components-popover__content {
        /* make it roomy but bounded */
        width: var(--cb-popover-width, 520px);
        max-width: min(calc(100vw - 40px), 640px);
    }

    .costered-blocks--token--popover .costered-blocks--token--panel {
        /* ensure input expands nicely in the popover */
        grid-template-columns: 1fr auto;
    }
}

/* GridItemControls sub-panels */